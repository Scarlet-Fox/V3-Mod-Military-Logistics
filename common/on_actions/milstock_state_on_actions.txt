########################################
##### On Monthly Pulse for a State #####
########################################

on_monthly_pulse_state = {
    on_actions = {
        milstock_check_variables
        milstock_increase_stockpiles
        milstock_drain_stockpiles
        check_state_ownership
    }
}


# Ensure that the stockpile variable exists
# ---------------------------------------------------------
# Make sure variables exist for stockpile (somehow they can be removed???)

milstock_check_variables = {
    effect = {
        if = {
            limit = {
                has_building = milstock_building_logistics_center
                NOT = {
                    has_variable = milstock_state_small_arms_stockpile_var
                    has_variable = milstock_state_grain_stockpile_var
                    has_variable = milstock_state_liquor_stockpile_var
                    has_variable = milstock_state_sugar_stockpile_var
                    has_variable = milstock_state_opium_stockpile_var
                    has_variable = milstock_state_tobacco_stockpile_var
                    has_variable = milstock_state_fabric_stockpile_var
                    has_variable = milstock_state_groceries_stockpile_var
                    has_variable = milstock_state_ammunition_stockpile_var
                    has_variable = milstock_state_artillery_stockpile_var
                    has_variable = milstock_state_radios_stockpile_var
                    has_variable = milstock_state_tanks_stockpile_var
                    has_variable = milstock_state_oil_stockpile_var
                    has_variable = milstock_state_iron_stockpile_var
                }
            }

            set_variable = {
                name = milstock_state_small_arms_stockpile_var
                value = 0
            }
            set_variable = {
                name = milstock_state_grain_stockpile_var
                value = 0
            }
            set_variable = {
                name = milstock_state_liquor_stockpile_var
                value = 0
            }
            set_variable = {
                name = milstock_state_sugar_stockpile_var
                value = 0
            }
            set_variable = {
                name = milstock_state_opium_stockpile_var
                value = 0
            }
            set_variable = {
                name = milstock_state_tobacco_stockpile_var
                value = 0
            }
            set_variable = {
                name = milstock_state_fabric_stockpile_var
                value = 0
            }
            set_variable = {
                name = milstock_state_groceries_stockpile_var
                value = 0
            }
            set_variable = {
                name = milstock_state_ammunition_stockpile_var
                value = 0
            }
            set_variable = {
                name = milstock_state_artillery_stockpile_var
                value = 0
            }
            set_variable = {
                name = milstock_state_radios_stockpile_var
                value = 0
            }
            set_variable = {
                name = milstock_state_tanks_stockpile_var
                value = 0
            }
            set_variable = {
                name = milstock_state_oil_stockpile_var
                value = 0
            }
            set_variable = {
                name = milstock_state_iron_stockpile_var
                value = 0
            }
            set_variable = {
                name = logistics_center_max_stockpile
                value = 4000
            }
            set_variable = {
                name = logistics_center_current_stockpile
                value = 0
            }
            set_variable = {
                name = milstock_state_last_owned_by
                value = this.owner
            }
        }
    }
}

# Increase Military Stockpiles
# ---------------------------------------------------------

# ROOT SCCOPE = State
# NOTE - ALL CHANGE VARIABLE ENTRIES NEED TO MATCH PRODUCTION METHOD VALUES FOR CONSISTENCY
milstock_increase_stockpiles = {
    effect = {
        if = {
            limit = {
                has_building = milstock_building_logistics_center
            }

            every_scope_building = {
                limit = {
                    is_building_type = milstock_building_logistics_center
                }

                save_scope_as = logistics_center
                ROOT = {
                    set_variable = {
                        name = milstock_staff_purchasing_ratio_var
                        value = milstock_sv_staff_purchasing_ratio
                    }
                }
            }

            # Update stockpile for Infantry :: Basic Equipment
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_logistics_center
                        production_method = milstock_logicenter_infantry_pm_basic
                    }
                }
                change_variable = { 
                    name = milstock_state_small_arms_stockpile_var 
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_grain_stockpile_var 
                    add = {
                        add = 5
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Update stockpile for Infantry :: Ammunition Included
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_logistics_center
                        production_method = milstock_logicenter_infantry_pm_ammo
                    }
                }
                change_variable = { 
                    name = milstock_state_small_arms_stockpile_var 
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_grain_stockpile_var 
                    add = {
                        add = 5
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_ammunition_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Update stockpile for Infantry :: Radios Included
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_logistics_center
                        production_method = milstock_logicenter_infantry_pm_radios
                    }
                }
                change_variable = { 
                    name = milstock_state_small_arms_stockpile_var 
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_grain_stockpile_var 
                    add = {
                        add = 5
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_ammunition_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_radios_stockpile_var
                    add = {
                        add = 3
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Update stockpile for Infantry :: Mechanization Focus
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_logistics_center
                        production_method = milstock_logicenter_infantry_pm_mech
                    }
                }
                change_variable = { 
                    name = milstock_state_small_arms_stockpile_var 
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_grain_stockpile_var 
                    add = {
                        add = 5
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_ammunition_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_radios_stockpile_var
                    add = {
                        add = 3
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_tanks_stockpile_var
                    add = {
                        add = 3
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_oil_stockpile_var
                    add = {
                        add = 3
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }


            # Update stockpile for Artillery :: Basic Equipment
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_logistics_center
                        production_method = milstock_logicenter_artillery_pm_basic
                    }
                }
                change_variable = { 
                    name = milstock_state_artillery_stockpile_var 
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_grain_stockpile_var 
                    add = {
                        add = 5
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Update stockpile for Artillery :: Ammunition Included
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_logistics_center
                        production_method = milstock_logicenter_artillery_pm_ammo
                    }
                }
                change_variable = { 
                    name = milstock_state_artillery_stockpile_var 
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_grain_stockpile_var 
                    add = {
                        add = 5
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_ammunition_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Update stockpile for Artillery :: Radios Included
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_logistics_center
                        production_method = milstock_logicenter_artillery_pm_radios
                    }
                }
                change_variable = { 
                    name = milstock_state_artillery_stockpile_var 
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_grain_stockpile_var 
                    add = {
                        add = 5
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_ammunition_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_radios_stockpile_var
                    add = {
                        add = 3
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Update stockpile for Artillery :: Heavy Tank Focus
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_logistics_center
                        production_method = milstock_logicenter_artillery_pm_tank
                    }
                }
                change_variable = { 
                    name = milstock_state_artillery_stockpile_var 
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_grain_stockpile_var 
                    add = {
                        add = 5
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_ammunition_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_radios_stockpile_var
                    add = {
                        add = 5
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_tanks_stockpile_var
                    add = {
                        add = 7
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_oil_stockpile_var
                    add = {
                        add = 7
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Update stockpile for Calvary :: Basic Equipment
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_logistics_center
                        production_method = milstock_logicenter_calvary_pm_basic
                    }
                }
                change_variable = { 
                    name = milstock_state_grain_stockpile_var 
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Update stockpile for Calvary :: Small Arms Included
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_logistics_center
                        production_method = milstock_logicenter_calvary_pm_small_arms
                    }
                }
                change_variable = { 
                    name = milstock_state_grain_stockpile_var 
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_small_arms_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Update stockpile for Calvary :: Armor Included
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_logistics_center
                        production_method = milstock_logicenter_calvary_pm_armored
                    }
                }
                change_variable = { 
                    name = milstock_state_grain_stockpile_var 
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_small_arms_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_iron_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Update stockpile for Calvary :: Light Tank Focus
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_logistics_center
                        production_method = milstock_logicenter_calvary_pm_tank
                    }
                }
                change_variable = { 
                    name = milstock_state_grain_stockpile_var 
                    add = {
                        add = 5
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_small_arms_stockpile_var
                    add = {
                        add = 5
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_artillery_stockpile_var
                    add = {
                        add = 5
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_ammunition_stockpile_var
                    add = {
                        add = 5
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_radios_stockpile_var
                    add = {
                        add = 5
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_tanks_stockpile_var
                    add = {
                        add = 5
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_oil_stockpile_var
                    add = {
                        add = 5
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Update stockpile for Mobilization Supplies :: Grain Only
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_logistics_center
                        production_method = milstock_logicenter_mobil_pm_grain
                    }
                }
                change_variable = { 
                    name = milstock_state_grain_stockpile_var 
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Update stockpile for Mobilization Supplies :: Basic Supplies
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_logistics_center
                        production_method = milstock_logicenter_mobil_pm_basic
                    }
                }
                change_variable = { 
                    name = milstock_state_grain_stockpile_var 
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_fabric_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_liquor_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Update stockpile for Mobilization Supplies :: Groceries Included
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_logistics_center
                        production_method = milstock_logicenter_mobil_pm_groceries
                    }
                }
                change_variable = { 
                    name = milstock_state_grain_stockpile_var 
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_fabric_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_liquor_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_groceries_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Update stockpile for Mobilization Supplies :: Sugar Included
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_logistics_center
                        production_method = milstock_logicenter_mobil_pm_sugar
                    }
                }
                change_variable = { 
                    name = milstock_state_grain_stockpile_var 
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_fabric_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_liquor_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_groceries_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_sugar_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Update stockpile for Mobilization Supplies :: Tobacco Included
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_logistics_center
                        production_method = milstock_logicenter_mobil_pm_tobacco
                    }
                }
                change_variable = { 
                    name = milstock_state_grain_stockpile_var 
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_fabric_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_liquor_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_groceries_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_sugar_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_tobacco_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Update stockpile for Mobilization Supplies :: Opium Included
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_logistics_center
                        production_method = milstock_logicenter_mobil_pm_opium
                    }
                }
                change_variable = { 
                    name = milstock_state_grain_stockpile_var 
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_fabric_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_liquor_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_groceries_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_sugar_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_tobacco_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
                change_variable = { 
                    name = milstock_state_opium_stockpile_var
                    add = {
                        add = 10
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Clamp all stockpile variables to maximum limit to prevent excessive silliness
            # --------------------------------------------------------------------------------
            clamp_variable = { name = milstock_state_grain_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_small_arms_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_liquor_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_sugar_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_opium_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_tobacco_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_fabric_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_groceries_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_ammunition_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_artillery_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_radios_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_tanks_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_oil_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_iron_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            
            # Setup the total of all stockpile values for goods in this state
            # --------------------------------------------------------------------------------
            set_variable = {
                name = logistics_center_current_stockpile
                value = {
                    add = var:milstock_state_grain_stockpile_var
                    add = var:milstock_state_small_arms_stockpile_var
                    add = var:milstock_state_liquor_stockpile_var
                    add = var:milstock_state_sugar_stockpile_var
                    add = var:milstock_state_opium_stockpile_var
                    add = var:milstock_state_tobacco_stockpile_var
                    add = var:milstock_state_fabric_stockpile_var
                    add = var:milstock_state_groceries_stockpile_var
                    add = var:milstock_state_ammunition_stockpile_var
                    add = var:milstock_state_artillery_stockpile_var
                    add = var:milstock_state_radios_stockpile_var
                    add = var:milstock_state_tanks_stockpile_var
                    add = var:milstock_state_oil_stockpile_var
                    add = var:milstock_state_iron_stockpile_var
                }
            }
            
            # Setup the maximum stockpile value for goods in this state
            # --------------------------------------------------------------------------------
            set_variable = {
                name = logistics_center_max_stockpile
                value = milstock_sv_max
            }
        }
    }
}

# Drain Military Stockpiles
# ---------------------------------------------------------
milstock_drain_stockpiles = {
    effect = {
        if = {
            # Only triggers if distribution center exists AND a logistics center exists
            limit = {
                has_building = milstock_building_logistics_center
                OR = {
                    has_building = milstock_building_distribution_small_arms
                    has_building = milstock_building_distribution_grain
                    has_building = milstock_building_distribution_liquor
                    has_building = milstock_building_distribution_sugar
                    has_building = milstock_building_distribution_opium
                    has_building = milstock_building_distribution_tobacco
                    has_building = milstock_building_distribution_fabric
                    has_building = milstock_building_distribution_groceries
                    has_building = milstock_building_distribution_ammunition
                    has_building = milstock_building_distribution_artillery
                    has_building = milstock_building_distribution_radios
                    has_building = milstock_building_distribution_tanks
                    has_building = milstock_building_distribution_oil
                    has_building = milstock_building_distribution_iron
                }
            }

            # We'll use logistics center level since that should
            # be the same as the stockpile levels.
            #
            # We don't care about distribution center staffing, since
            # quite honestly, that would be a PITA to implement while
            # not adding anything fun.
            every_scope_building = {
                limit = {
                    is_building_type = milstock_building_logistics_center
                }

                save_scope_as = logistics_center
                ROOT = {
                    set_variable = {
                        name = milstock_staff_purchasing_ratio_var
                        value = milstock_sv_staff_purchasing_ratio
                    }
                }
            }

            # Drain grain stockpile if the building exists
            # ------------------------------------------------------
            ## Standard production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_grain
                        production_method = milstock_pm_dist_grain
                    }
                }
                change_variable = { 
                    name = milstock_state_grain_stockpile_var
                    add = {
                        subtract = 60
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }
            ## Double production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_grain
                        production_method = milstock_pm_dist_grain_double
                    }
                }
                change_variable = { 
                    name = milstock_state_grain_stockpile_var
                    add = {
                        subtract = 120
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Drain small arms stockpile if the building exists
            # ------------------------------------------------------
            ## Standard production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_small_arms
                        production_method = milstock_pm_dist_small_arms
                    }
                }
                change_variable = { 
                    name = milstock_state_small_arms_stockpile_var
                    add = {
                        subtract = 40
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }
            ## Double production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_small_arms
                        production_method = milstock_pm_dist_small_arms_double
                    }
                }
                change_variable = { 
                    name = milstock_state_small_arms_stockpile_var
                    add = {
                        subtract = 80
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Drain liquor stockpile if the building exists
            # ------------------------------------------------------
            ## Standard production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_liquor
                        production_method = milstock_pm_dist_liquor
                    }
                }
                change_variable = { 
                    name = milstock_state_liquor_stockpile_var
                    add = {
                        subtract = 20
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }
            ## Double production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_liquor
                        production_method = milstock_pm_dist_liquor_double
                    }
                }
                change_variable = { 
                    name = milstock_state_liquor_stockpile_var
                    add = {
                        subtract = 40
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Drain sugar stockpile if the building exists
            # ------------------------------------------------------
            ## Standard production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_sugar
                        production_method = milstock_pm_dist_sugar
                    }
                }
                change_variable = { 
                    name = milstock_state_sugar_stockpile_var
                    add = {
                        subtract = 20
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }
            ## Double production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_sugar
                        production_method = milstock_pm_dist_sugar_double
                    }
                }
                change_variable = { 
                    name = milstock_state_sugar_stockpile_var
                    add = {
                        subtract = 40
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Drain opium stockpile if the building exists
            # ------------------------------------------------------
            ## Standard production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_opium
                        production_method = milstock_pm_dist_opium
                    }
                }
                change_variable = { 
                    name = milstock_state_opium_stockpile_var
                    add = {
                        subtract = 20
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }
            ## Double production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_opium
                        production_method = milstock_pm_dist_opium_double
                    }
                }
                change_variable = { 
                    name = milstock_state_opium_stockpile_var
                    add = {
                        subtract = 40
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Drain tobacco stockpile if the building exists
            # ------------------------------------------------------
            ## Standard production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_tobacco
                        production_method = milstock_pm_dist_tobacco
                    }
                }
                change_variable = { 
                    name = milstock_state_tobacco_stockpile_var
                    add = {
                        subtract = 20
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }
            ## Double production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_tobacco
                        production_method = milstock_pm_dist_tobacco_double
                    }
                }
                change_variable = { 
                    name = milstock_state_tobacco_stockpile_var
                    add = {
                        subtract = 40
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Drain fabric stockpile if the building exists
            # ------------------------------------------------------
            ## Standard production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_fabric
                        production_method = milstock_pm_dist_fabric
                    }
                }
                change_variable = { 
                    name = milstock_state_fabric_stockpile_var
                    add = {
                        subtract = 20
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }
            ## Double production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_fabric
                        production_method = milstock_pm_dist_fabric_double
                    }
                }
                change_variable = { 
                    name = milstock_state_fabric_stockpile_var
                    add = {
                        subtract = 40
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Drain groceries stockpile if the building exists
            # ------------------------------------------------------
            ## Standard production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_groceries
                        production_method = milstock_pm_dist_groceries
                    }
                }
                change_variable = { 
                    name = milstock_state_groceries_stockpile_var
                    add = {
                        subtract = 20
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }
            ## Double production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_groceries
                        production_method = milstock_pm_dist_groceries_double
                    }
                }
                change_variable = { 
                    name = milstock_state_groceries_stockpile_var
                    add = {
                        subtract = 40
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Drain ammunition stockpile if the building exists
            # ------------------------------------------------------
            ## Standard production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_ammunition
                        production_method = milstock_pm_dist_ammunition
                    }
                }
                change_variable = { 
                    name = milstock_state_ammunition_stockpile_var
                    add = {
                        subtract = 40
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }
            ## Double production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_ammunition
                        production_method = milstock_pm_dist_ammunition_double
                    }
                }
                change_variable = { 
                    name = milstock_state_ammunition_stockpile_var
                    add = {
                        subtract = 80
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Drain tanks stockpile if the building exists
            # ------------------------------------------------------
            ## Standard production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_tanks
                        production_method = milstock_pm_dist_tanks
                    }
                }
                change_variable = { 
                    name = milstock_state_tanks_stockpile_var
                    add = {
                        subtract = 30
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }
            ## Double production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_tanks
                        production_method = milstock_pm_dist_tanks_double
                    }
                }
                change_variable = { 
                    name = milstock_state_tanks_stockpile_var
                    add = {
                        subtract = 60
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Drain radios stockpile if the building exists
            # ------------------------------------------------------
            ## Standard production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_radios
                        production_method = milstock_pm_dist_radios
                    }
                }
                change_variable = { 
                    name = milstock_state_radios_stockpile_var
                    add = {
                        subtract = 20
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }
            ## Double production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_radios
                        production_method = milstock_pm_dist_radios_double
                    }
                }
                change_variable = { 
                    name = milstock_state_radios_stockpile_var
                    add = {
                        subtract = 40
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Drain artillery stockpile if the building exists
            # ------------------------------------------------------
            ## Standard production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_artillery
                        production_method = milstock_pm_dist_artillery
                    }
                }
                change_variable = { 
                    name = milstock_state_artillery_stockpile_var
                    add = {
                        subtract = 30
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }
            ## Double production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_artillery
                        production_method = milstock_pm_dist_artillery_double
                    }
                }
                change_variable = { 
                    name = milstock_state_artillery_stockpile_var
                    add = {
                        subtract = 60
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Drain oil stockpile if the building exists
            # ------------------------------------------------------
            ## Standard production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_oil
                        production_method = milstock_pm_dist_oil
                    }
                }
                change_variable = { 
                    name = milstock_state_oil_stockpile_var
                    add = {
                        subtract = 30
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }
            ## Double production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_oil
                        production_method = milstock_pm_dist_oil_double
                    }
                }
                change_variable = { 
                    name = milstock_state_oil_stockpile_var
                    add = {
                        subtract = 60
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Drain iron stockpile if the building exists
            # ------------------------------------------------------
            ## Standard production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_iron
                        production_method = milstock_pm_dist_iron
                    }
                }
                change_variable = { 
                    name = milstock_state_iron_stockpile_var
                    add = {
                        subtract = 20
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }
            ## Double production method
            if = {
                limit = {
                    is_production_method_active = {
                        building_type = milstock_building_distribution_iron
                        production_method = milstock_pm_dist_iron_double
                    }
                }
                change_variable = { 
                    name = milstock_state_iron_stockpile_var
                    add = {
                        subtract = 40
                        multiply = var:milstock_staff_purchasing_ratio_var
                        multiply = scope:logistics_center.level
                        multiply = 4.33 # Weeks per month
                    }
                }
            }

            # Stop grain distribution if stockpile is empty
            # ------------------------------------------------------
            if = {
                limit = {
                    has_building = milstock_building_distribution_grain
                    var:milstock_state_grain_stockpile_var < 0
                }
                remove_building = milstock_building_distribution_grain
                set_variable = { name = grain_stockpile_exhausted_recently days = 120 }
            }

            # Stop small arms distribution if stockpile is empty
            # ------------------------------------------------------
            if = {
                limit = {
                    has_building = milstock_building_distribution_small_arms
                    var:milstock_state_small_arms_stockpile_var < 0
                }
                remove_building = milstock_building_distribution_small_arms
                set_variable = { name = small_arms_stockpile_exhausted_recently days = 120 }
            }

            # Stop liquor distribution if stockpile is empty
            # ------------------------------------------------------
            if = {
                limit = {
                    has_building = milstock_building_distribution_liquor
                    var:milstock_state_liquor_stockpile_var < 0
                }
                remove_building = milstock_building_distribution_liquor
                set_variable = { name = liquor_stockpile_exhausted_recently days = 120 }
            }

            # Stop sugar distribution if stockpile is empty
            # ------------------------------------------------------
            if = {
                limit = {
                    has_building = milstock_building_distribution_sugar
                    var:milstock_state_sugar_stockpile_var < 0
                }
                remove_building = milstock_building_distribution_sugar
                set_variable = { name = sugar_stockpile_exhausted_recently days = 120 }
            }

            # Stop opium distribution if stockpile is empty
            # ------------------------------------------------------
            if = {
                limit = {
                    has_building = milstock_building_distribution_opium
                    var:milstock_state_opium_stockpile_var < 0
                }
                remove_building = milstock_building_distribution_opium
                set_variable = { name = opium_stockpile_exhausted_recently days = 120 }
            }

            # Stop tobacco distribution if stockpile is empty
            # ------------------------------------------------------
            if = {
                limit = {
                    has_building = milstock_building_distribution_tobacco
                    var:milstock_state_tobacco_stockpile_var < 0
                }
                remove_building = milstock_building_distribution_tobacco
                set_variable = { name = tobacco_stockpile_exhausted_recently days = 120 }
            }

            # Stop fabric distribution if stockpile is empty
            # ------------------------------------------------------
            if = {
                limit = {
                    has_building = milstock_building_distribution_fabric
                    var:milstock_state_fabric_stockpile_var < 0
                }
                remove_building = milstock_building_distribution_fabric
                set_variable = { name = fabric_stockpile_exhausted_recently days = 120 }
            }

            # Stop groceries distribution if stockpile is empty
            # ------------------------------------------------------
            if = {
                limit = {
                    has_building = milstock_building_distribution_groceries
                    var:milstock_state_groceries_stockpile_var < 0
                }
                remove_building = milstock_building_distribution_groceries
                set_variable = { name = groceries_stockpile_exhausted_recently days = 120 }
            }

            # Stop ammunition distribution if stockpile is empty
            # ------------------------------------------------------
            if = {
                limit = {
                    has_building = milstock_building_distribution_ammunition
                    var:milstock_state_ammunition_stockpile_var < 0
                }
                remove_building = milstock_building_distribution_ammunition
                set_variable = { name = ammunition_stockpile_exhausted_recently days = 120 }
            }

            # Stop artillery distribution if stockpile is empty
            # ------------------------------------------------------
            if = {
                limit = {
                    has_building = milstock_building_distribution_artillery
                    var:milstock_state_artillery_stockpile_var < 0
                }
                remove_building = milstock_building_distribution_artillery
                set_variable = { name = artillery_stockpile_exhausted_recently days = 120 }
            }

            # Stop radios distribution if stockpile is empty
            # ------------------------------------------------------
            if = {
                limit = {
                    has_building = milstock_building_distribution_radios
                    var:milstock_state_radios_stockpile_var < 0
                }
                remove_building = milstock_building_distribution_radios
                set_variable = { name = radios_stockpile_exhausted_recently days = 120 }
            }

            # Stop tanks distribution if stockpile is empty
            # ------------------------------------------------------
            if = {
                limit = {
                    has_building = milstock_building_distribution_tanks
                    var:milstock_state_tanks_stockpile_var < 0
                }
                remove_building = milstock_building_distribution_tanks
                set_variable = { name = tanks_stockpile_exhausted_recently days = 120 }
            }

            # Stop oil distribution if stockpile is empty
            # ------------------------------------------------------
            if = {
                limit = {
                    has_building = milstock_building_distribution_oil
                    var:milstock_state_oil_stockpile_var < 0
                }
                remove_building = milstock_building_distribution_oil
                set_variable = { name = oil_stockpile_exhausted_recently days = 120 }
            }

            # Stop iron distribution if stockpile is empty
            # ------------------------------------------------------
            if = {
                limit = {
                    has_building = milstock_building_distribution_iron
                    var:milstock_state_iron_stockpile_var < 0
                }
                remove_building = milstock_building_distribution_iron
                set_variable = { name = iron_stockpile_exhausted_recently days = 120 }
            }

            # Clamp all stockpile variables to zero for neatness purposes
            # ------------------------------------------------------
            clamp_variable = { name = milstock_state_grain_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_small_arms_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_liquor_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_sugar_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_opium_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_tobacco_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_fabric_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_groceries_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_ammunition_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_artillery_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_radios_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_tanks_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_oil_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            clamp_variable = { name = milstock_state_iron_stockpile_var min = milstock_sv_min max = milstock_sv_max }
            
            # Setup the total of all stockpile values for goods in this state
            # --------------------------------------------------------------------------------
            set_variable = {
                name = logistics_center_current_stockpile
                value = {
                    add = var:milstock_state_grain_stockpile_var
                    add = var:milstock_state_small_arms_stockpile_var
                    add = var:milstock_state_liquor_stockpile_var
                    add = var:milstock_state_sugar_stockpile_var
                    add = var:milstock_state_opium_stockpile_var
                    add = var:milstock_state_tobacco_stockpile_var
                    add = var:milstock_state_fabric_stockpile_var
                    add = var:milstock_state_groceries_stockpile_var
                    add = var:milstock_state_ammunition_stockpile_var
                    add = var:milstock_state_artillery_stockpile_var
                    add = var:milstock_state_radios_stockpile_var
                    add = var:milstock_state_tanks_stockpile_var
                    add = var:milstock_state_oil_stockpile_var
                    add = var:milstock_state_iron_stockpile_var
                }
            }

            # Setup the maximum stockpile value for goods in this state
            # --------------------------------------------------------------------------------
            set_variable = {
                name = logistics_center_max_stockpile
                value = milstock_sv_max
            }
        }
    }
}

# Check State Ownership
# ---------------------------------------------------------

check_state_ownership = {
    effect = {
        # Housekeeping - Set the last owner of this state if it isn't set and the state 
        # has a logistics center.
        if = {
            limit = {
                has_building = milstock_building_logistics_center
                NOT = {
                    has_variable = milstock_state_last_owned_by
                }
            }
            set_variable = {
                name = milstock_state_last_owned_by
                value = this.owner
            }
        }

        # Now, if the state's current owner is not the same as the last owner
        if = {
            limit = {
                has_variable = milstock_state_last_owned_by
                NOT = {
                    this.owner = var:milstock_state_last_owned_by
                }
            }

            # then, we wipe out 75% of the stockpiled amounts
            change_variable = { name = milstock_state_grain_stockpile_var multiply = 0.25 }
            change_variable = { name = milstock_state_small_arms_stockpile_var multiply = 0.25 }
            change_variable = { name = milstock_state_liquor_stockpile_var multiply = 0.25 }
            change_variable = { name = milstock_state_sugar_stockpile_var multiply = 0.25 }
            change_variable = { name = milstock_state_opium_stockpile_var multiply = 0.25 }
            change_variable = { name = milstock_state_tobacco_stockpile_var multiply = 0.25 }
            change_variable = { name = milstock_state_fabric_stockpile_var multiply = 0.25 }
            change_variable = { name = milstock_state_groceries_stockpile_var multiply = 0.25 }
            change_variable = { name = milstock_state_ammunition_stockpile_var multiply = 0.25 }
            change_variable = { name = milstock_state_artillery_stockpile_var multiply = 0.25 }
            change_variable = { name = milstock_state_radios_stockpile_var multiply = 0.25 }
            change_variable = { name = milstock_state_tanks_stockpile_var multiply = 0.25 }
            change_variable = { name = milstock_state_oil_stockpile_var multiply = 0.25 }
            change_variable = { name = milstock_state_iron_stockpile_var multiply = 0.25 }
            set_variable = { name = milstock_state_last_owned_by value = this.owner }

            # Note - see the country on actions for the housekeeping code that ensures we 
            # don't wipe stockpiles when a country is released or formed.
        }
    }
}