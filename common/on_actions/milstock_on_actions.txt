# When a logistics center is built, let's create the variables to track the stockpile amounts.
# I have no idea if we're suppose to pre-create them, but this soothes my neurosis, and
# it's important for my neurosis to be abated.
on_building_built = {
	on_actions = {
		milstock_logicenter_constructed
	}
}

# ROOT SCCOPE = Building
milstock_logicenter_constructed = {
	effect = {
    	if = {
        	limit = {
            	is_building_type = milstock_building_logistics_center
			}
			ROOT.state = {
				set_variable = {
					name = milstock_state_small_arms_stockpile_var
					value = 0
				}
				set_variable = {
					name = milstock_state_grain_stockpile_var
					value = 0
				}
				set_variable = {
					name = milstock_state_liquor_stockpile_var
					value = 0
				}
				set_variable = {
					name = milstock_state_sugar_stockpile_var
					value = 0
				}
				set_variable = {
					name = milstock_state_opium_stockpile_var
					value = 0
				}
				set_variable = {
					name = milstock_state_tobacco_stockpile_var
					value = 0
				}
				set_variable = {
					name = milstock_state_fabric_stockpile_var
					value = 0
				}
				set_variable = {
					name = milstock_state_groceries_stockpile_var
					value = 0
				}
				set_variable = {
					name = milstock_state_ammunition_stockpile_var
					value = 0
				}
				set_variable = {
					name = milstock_state_artillery_stockpile_var
					value = 0
				}
				set_variable = {
					name = milstock_state_radios_stockpile_var
					value = 0
				}
				set_variable = {
					name = milstock_state_tanks_stockpile_var
					value = 0
				}
				set_variable = {
					name = milstock_state_oil_stockpile_var
					value = 0
				}
				set_variable = {
					name = milstock_state_iron_stockpile_var
					value = 0
				}
				debug_log_scopes = yes
			}
			debug_log = "Logistics center building constructed."
			debug_log_scopes = yes
		}
	}
}

on_monthly_pulse_state = {
	on_actions = {
		milstock_increase_stockpiles
	}
}

# ROOT SCCOPE = State
# NOTE - ALL CHANGE VARIABLE ENTRIES NEED TO MATCH PRODUCTION METHOD VALUES FOR CONSISTENCY
milstock_increase_stockpiles = {
	effect = {
		if = {
			limit = {
				has_building = milstock_building_logistics_center
			}

			every_scope_building = {
				limit = {
					is_building_type = milstock_building_logistics_center
				}

				save_scope_as = logistics_center
				ROOT = {
					set_variable = {
						name = milstock_staff_purchasing_ratio_var
						value = milstock_sv_staff_purchasing_ratio
					}
				}
			}

			# Update stockpile for Infantry :: Basic Equipment
			if = {
				limit = {
					is_production_method_active = {
						building_type = milstock_building_logistics_center
						production_method = milstock_logicenter_infantry_pm_basic
					}
				}
				change_variable = { 
					name = milstock_state_small_arms_stockpile_var 
					add = {
						add = 10
						multiply = var:milstock_staff_purchasing_ratio_var
					}
				}
			}
		}
		# Get current employment ratios for this state's logistics center
#		every_scope_building = {
#			limit = {
#				is_building_type = milstock_building_logistics_center
#			}
#			save_scope_as = logistics_center
#			ROOT = {
#				set_variable = {
#					name = milstock_clerk_purchasing_ratio_var
#					value = milstock_sv_clerk_purchasing_ratio
#				}
#				set_variable = {
#					name = milstock_officer_employment_penalty_var
#					value = milstock_sv_officer_employment_penalty
#				}
#			}
#		}

		
#		if = {
#			limit = {
#				is_production_method_active = {
#					building_type = milstock_building_logistics_center
#					production_method = milstock_logicenter_infantry_pm_basic
#				}
#			}
#
#			set_variable = { 
#				name = milstock_state_small_arms_stockpile_var 
#				value = {
#					add = var:milstock_state_small_arms_stockpile_var
#					add = 10
#				}
#			}
#			change_variable = { name = milstock_state_small_arms_stockpile_var multiply = var:milstock_clerk_purchasing_ratio_var }
#			change_variable = { name = milstock_state_small_arms_stockpile_var multiply = var:milstock_officer_employment_penalty_var }

#			change_variable = { name = milstock_state_grain_stockpile_var add = 5 }
#			change_variable = { name = milstock_state_grain_stockpile_var multiply = var:milstock_clerk_purchasing_ratio_var }
#			change_variable = { name = milstock_state_grain_stockpile_var multiply = var:milstock_officer_employment_penalty_var }
#		}
	}
}


# If the state has a logistics center
# For each production method, add the purchased goods multiplied by the clerk employment ratio to the stockpile
# |--> Apply a 20% malus if the officer employment ratio is less than 50%

# Each month, we'll add a scaled representation of the month's stockpiled amount to the
# stockpile in any state with a building.
#on_monthly_pulse_state = {
#   effect = {
#       if = {
#           limit = {
#               has_building = milstock_building_stockpiles
#           }
#           every_scope_building = {
#               limit = {
#                   is_building_type = milstock_building_stockpiles
#               }
#               ROOT.state = {
#                   set_variable = {
#                       name = milstock_state_small_arms_stockpile_increase_var
#                       value = {
#                           
#                       }
#                   }
#               }
#           }
#
#           change_variable = {
#               name = milstock_state_small_arms_stockpile_var
#               add = {
#
#               }
#           }
#       }
#   }
#}